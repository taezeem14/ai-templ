<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HackoAI ‚Ä¢ Chat Interface</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Smooch+Sans:wght@100..900&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}

/* ===== THEME ===== */
:root{
  --bg:#f4f4f5; --panel:#fff; --chat:#f9fafb;
  --border:#e5e7eb; --user:#2563eb; --bot:#e5e7eb;
  --text:#111827; --muted:#6b7280; --link:#2563eb;
}
body.dark{
  --bg:#020617; --panel:#0f172a; --chat:#1e293b;
  --border:#1f2937; --user:#2563eb; --bot:#0f172a;
  --text:#e5e7eb; --muted:#94a3b8; --link:#22c55e;
}

body{
  font-family:system-ui,sans-serif;
  background:var(--bg);
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  color:var(--text);
}

.app{
  width:100%;
  max-width:650px;
  height:90vh;
  background:var(--panel);
  border-radius:14px;
  display:flex;
  flex-direction:column;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
  overflow:hidden;
}

header{
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
}

.controls{display:flex;gap:8px}
button.toggle, select{
  background:transparent;
  border:1px solid var(--border);
  color:var(--text);
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
}

/* ===== CHAT ===== */
#chat{
  flex:1;
  padding:16px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:16px;
  background:var(--chat);
}

.msg{
  max-width:85%;
  padding:12px 14px;
  border-radius:12px;
  line-height:1.5;
  animation:fadeIn .25s forwards;
  word-wrap:break-word;
}

.user{align-self:flex-end;background:var(--user);color:#fff}
.bot{align-self:flex-start;background:var(--bot)}

.timestamp{
  font-size:10px;
  color:var(--muted);
  margin-top:6px;
}

/* ===== CODE ===== */
pre{
  position:relative;
  background:#020617;
  border-radius:10px;
  padding:12px;
  margin-top:8px;
  overflow-x:auto;
}
.copy-btn{
  position:absolute;
  top:6px;right:6px;
  background:#2563eb;
  border:none;
  color:#fff;
  font-size:11px;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
}

/* ===== FOOTER ===== */
footer{
  display:flex;
  gap:8px;
  padding:12px;
  border-top:1px solid var(--border);
}

input{
  flex:1;
  padding:12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--text);
  outline:none;
}

button.send{
  padding:0 18px;
  border-radius:8px;
  border:none;
  background:#2563eb;
  color:#fff;
  font-weight:600;
}

/* ===== LOADER ===== */
.spinner{
  width:18px;height:18px;
  border:3px solid var(--border);
  border-top:3px solid #2563eb;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeIn{to{opacity:1}}
</style>
</head>

<body class="dark">

<div class="app">
<header>
  HackoAI
  <div class="controls">
    <select id="mode">
      <option value="chat">Chat</option>
    </select>
    <button class="toggle" onclick="clearChat()">üóëÔ∏è</button>
    <button class="toggle" onclick="toggleTheme()">üåó</button>
  </div>
</header>

<div id="chat"></div>

<footer>
  <input id="input" placeholder="Type a message‚Ä¶" />
  <button class="send" onclick="send()">Send</button>
</footer>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const THEME_KEY="hackoai_theme";

/* ===== THEME ===== */
if(localStorage.getItem(THEME_KEY)==="light"){
  document.body.classList.remove("dark");
}
function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem(
    THEME_KEY,
    document.body.classList.contains("dark")?"dark":"light"
  );
}

/* ===== UTILS ===== */
function time(){
  const d=new Date();
  return d.getHours().toString().padStart(2,'0')+":"+
         d.getMinutes().toString().padStart(2,'0');
}

function preprocess(t){
  return t.replace(/~~(.*?)~~/g,"$1")
          .replace(/<\/?(s|del|strike)>/gi,"");
}

/* ===== RENDER ===== */
function render(role,content){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.innerHTML=marked.parse(preprocess(content));

  d.querySelectorAll("pre code").forEach(b=>{
    hljs.highlightElement(b);
    const btn=document.createElement("button");
    btn.className="copy-btn";
    btn.textContent="COPY";
    btn.onclick=()=>{
      navigator.clipboard.writeText(b.textContent);
      btn.textContent="COPIED";
      setTimeout(()=>btn.textContent="COPY",1000);
    };
    b.parentElement.appendChild(btn);
  });

  const t=document.createElement("div");
  t.className="timestamp";
  t.textContent=time();
  d.appendChild(t);

  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  return d;
}

/* ===== TYPEWRITER ===== */
function streamBot(text){
  const d=document.createElement("div");
  d.className="msg bot";
  chat.appendChild(d);

  let i=0;
  const interval=setInterval(()=>{
    d.innerHTML=marked.parse(preprocess(text.slice(0,i++)));
    chat.scrollTop=chat.scrollHeight;
    if(i>text.length){
      clearInterval(interval);
      d.remove();
      render("bot",text);
    }
  },15);
}

/* ===== SEND ===== */
async function send(){
  const text=input.value.trim();
  if(!text)return;
  input.value="";
  render("user",text);

  const loading=render("bot","<div class='spinner'></div>");

  try{
    const res=await fetch("/.netlify/functions/hackoAI",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ text })
    });
    const data=await res.json();
    loading.remove();

    const answer=data?.choices?.[0]?.message?.content;
    if(!answer){
      render("bot","üíÄ Empty response");
      return;
    }
    streamBot(answer);
  }catch{
    loading.remove();
    render("bot","Network error üíÄ");
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>
