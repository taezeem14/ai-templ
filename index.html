<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HackoAI â€¢ Chat Interface</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Markdown + Syntax Highlight -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}

/* ===== THEME ===== */
:root{
  --bg:#f4f4f5;--panel:#fff;--chat:#f9fafb;
  --border:#e5e7eb;--user:#2563eb;--bot:#e5e7eb;
  --text:#111827;--muted:#6b7280;
}
  
body.dark {
  --bg: #020617;      /* Page background - true dark */
  --panel: #0f172a;   /* Chat box background - slightly lighter so it pops */
  --chat: #1e293b;    /* Chat message area background - slightly different from panel */
  --border: #1f2937;
  --user: #2563eb;
  --bot: #0f172a;     /* Bot message background inside chat panel */
  --text: #e5e7eb;
  --muted: #94a3b8;
  
  body.dark a:hover {
  color: #4ade80; /* lighter green on hover */
}

  body.dark a {
  color: #22c55e; /* bright green */
  text-decoration: underline;
  }
body{
  font-family:system-ui,sans-serif;
  background:var(--bg);
  display:flex;justify-content:center;align-items:center;
  height:100vh;color:var(--text);
}

.app{
  width:100%;max-width:650px;height:90vh;
  background:var(--panel);border-radius:14px;
  display:flex;flex-direction:column;
  box-shadow:0 20px 40px rgba(0,0,0,.3);
  overflow:hidden;
}

header{
  padding:14px 16px;
  border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center;
  font-weight:600;
}

.controls{display:flex;gap:8px}
select,button.toggle{
  background:transparent;border:1px solid var(--border);
  color:var(--text);padding:6px 10px;border-radius:8px;
  cursor:pointer;
}

/* ===== CHAT ===== */
#chat{
  flex:1;padding:16px;overflow-y:auto;
  display:flex;flex-direction:column;gap:16px;
  background:var(--chat);
}

.msg{
  max-width:85%;padding:12px 14px;
  border-radius:12px;line-height:1.5;
  opacity:0;animation:fadeIn .25s forwards;
  position:relative;
}

.user{align-self:flex-end;background:var(--user);color:#fff}
.bot{align-self:flex-start;background:var(--bot);color:var(--text)}

.timestamp{
  font-size:10px;color:var(--muted);margin-top:6px;
}

/* ===== CODE BLOCKS ===== */
pre{
  position:relative;
  background:#020617;
  border-radius:10px;
  padding:12px;
  margin-top:8px;
  overflow-x:auto;
}

pre code{font-size:13px}

.copy-btn{
  position:absolute;
  top:6px;right:6px;
  background:#2563eb;
  border:none;color:#fff;
  font-size:11px;
  padding:4px 8px;
  border-radius:6px;
  cursor:pointer;
}

/* ===== FOOTER ===== */
footer{
  display:flex;gap:8px;padding:12px;
  border-top:1px solid var(--border);
}

input{
  flex:1;padding:12px;border-radius:8px;
  border:1px solid var(--border);
  background:transparent;color:var(--text);
  outline:none;
}

button.send{
  padding:0 18px;border-radius:8px;
  border:none;background:#2563eb;
  color:#fff;font-weight:600;cursor:pointer;
}

/* ===== LOADER ===== */
.spinner{
  width:18px;height:18px;
  border:3px solid var(--border);
  border-top:3px solid #2563eb;
  border-radius:50%;
  animation:spin 1s linear infinite;
}

@keyframes spin{to{transform:rotate(360deg)}}
@keyframes fadeIn{to{opacity:1}}
</style>
</head>

<body class="dark">

<div class="app">
  <header>
    HackoAI
    <div class="controls">
      <select id="mode">
        <option value="chat">Chat</option>
        <option value="image">Image</option>
      </select>
      <button class="toggle" onclick="toggleTheme()">ðŸŒ—</button>
    </div>
  </header>

  <div id="chat"></div>

  <footer>
    <input id="input" placeholder="Type a messageâ€¦" />
    <button class="send" onclick="send()">Send</button>
  </footer>
</div>

<script>
const chat=document.getElementById("chat");
const input=document.getElementById("input");
const mode=document.getElementById("mode");

/* ===== MEMORY ===== */
const KEY="hackoai_chat";
let history=JSON.parse(localStorage.getItem(KEY)||"[]");
history.forEach(m=>render(m.role,m.content,false));

function save(role,content){
  history.push({role,content});
  localStorage.setItem(KEY,JSON.stringify(history));
}

/* ===== UTILS ===== */
function time(){
  const d=new Date();
  return d.getHours().toString().padStart(2,'0')+":"+
         d.getMinutes().toString().padStart(2,'0');
}

/* ===== RENDER ===== */
function render(role,content,saveIt=true){
  const d=document.createElement("div");
  d.className="msg "+role;
  d.innerHTML=marked.parse(content);

  d.querySelectorAll("pre code").forEach(block=>{
    hljs.highlightElement(block);

    const btn=document.createElement("button");
    btn.className="copy-btn";
    btn.textContent="COPY";
    btn.onclick=()=>{
      navigator.clipboard.writeText(block.textContent);
      btn.textContent="COPIED";
      setTimeout(()=>btn.textContent="COPY",1000);
    };
    block.parentElement.appendChild(btn);
  });

  const t=document.createElement("div");
  t.className="timestamp";
  t.textContent=time();
  d.appendChild(t);

  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;

  if(saveIt) save(role,content);
  return d;
}

/* ===== TYPEWRITER ===== */
function streamBot(text){
  const d=document.createElement("div");
  d.className="msg bot";
  chat.appendChild(d);

  let i=0;
  const interval=setInterval(()=>{
    d.innerHTML=marked.parse(text.slice(0,i++));
    chat.scrollTop=chat.scrollHeight;
    if(i>text.length){
      clearInterval(interval);
      render("bot",text);
      d.remove();
    }
  },15);
}

/* ===== SEND ===== */
async function send(){
  const text=input.value.trim();
  if(!text) return;
  input.value="";

  render("user",text);

  const loading=render("bot","<div class='spinner'></div>",false);

  try{
    const res=await fetch("/.netlify/functions/hackoAI",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({text,mode:mode.value})
    });

    const data=await res.json();
    loading.remove();

    if(mode.value==="image"){
      render("bot",`![image](${data.data[0].url})`);
    }else{
      streamBot(data.choices[0].message.content);
    }

  }catch{
    loading.remove();
    render("bot","**Network error. Server folded ðŸ’€**");
  }
}

function toggleTheme(){
  document.body.classList.toggle("dark");
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});
</script>

</body>
</html>


